{% extends 'base.html' %}

{% block body %}
<div class="max-w-7xl mx-auto px-4 py-10 space-y-10">

  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-center gap-4">
    <h2 class="text-3xl font-semibold text-white">Dashboard</h2>
    <div class="flex items-center gap-4">
      <span class="text-white font-medium">Welcome, {{ user.username }}</span>
      <a href="{{ url_for('logout') }}"
        class="px-4 py-2 bg-red-500/80 text-white rounded-xl hover:bg-red-600/80 transition">
        Logout
      </a>
    </div>
  </div>

  <!-- Add Car Form -->
  <form action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data"
    class="glass p-6 flex flex-col lg:flex-row gap-4 items-center justify-center shadow-lg rounded-xl">
    <input type="text" name="name" placeholder="Car Name"
      class="px-4 py-2 rounded-xl bg-white/10 text-white placeholder-white/70 focus:bg-white/20 outline-none transition flex-1 min-w-[200px]"
      required>
    <input type="file" name="image" accept="image/*"
      class="px-4 py-2 rounded-xl bg-white/10 text-white focus:bg-white/20 outline-none transition flex-1 min-w-[200px]"
      required>
    <input type="text" name="notes" placeholder="Notes"
      class="px-4 py-2 rounded-xl bg-white/10 text-white placeholder-white/70 focus:bg-white/20 outline-none transition flex-1 min-w-[200px]">
    <button type="submit"
      class="px-6 py-2 bg-white/20 text-white font-semibold rounded-xl shadow-lg hover:bg-white/30 transition">
      âž• Add Car
    </button>
  </form>

  <!-- Car Grid -->
  {% if cars %}
  <div id="carGrid" class="grid gap-6 
              grid-cols-1 
              sm:grid-cols-2 
              md:grid-cols-3 
              lg:grid-cols-4 
              xl:grid-cols-5">
    {% for car in cars %}
    <div
      class="glass p-4 rounded-2xl flex flex-col items-center shadow-lg hover:scale-105 transition transform car-card">
      <img src="{{ url_for('static', filename='uploads/' ~ car.image_filename) }}" alt="{{ car.name }}"
        class="w-full h-44 object-cover rounded-xl mb-3 shadow-md">
      <h3 class="text-lg font-bold text-white mb-1 text-center truncate car-name">{{ car.name }}</h3>
      <p class="text-sm text-white/70 mb-3 text-center truncate car-notes">{{ car.notes }}</p>
      <div class="flex space-x-2">
        <a href="{{ url_for('car_detail', car_id=car.id) }}"
          class="px-3 py-1 bg-white/20 text-white rounded-xl hover:bg-white/30 transition">Details</a>
        <form action="{{ url_for('delete_car', car_id=car.id) }}" method="POST"
          onsubmit="return confirm('Delete this car?')">
          <button type="submit"
            class="px-3 py-1 bg-red-500/80 text-white rounded-xl hover:bg-red-600/80 transition">Delete</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-white/70 mt-10 text-lg">
    No cars yet! Add your first one ðŸ‘‰ <a href="{{ url_for('add_car') }}" class="underline">here</a>.
  </p>
  {% endif %}

  <!-- Floating Search Bar -->
  <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3 max-w-lg w-full px-4">
    <!-- Search Bar -->
    <div class="flex-1 glass px-4 py-2 rounded-2xl shadow-xl flex items-center space-x-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white/70" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
      </svg>
      <input id="searchInput" type="text" placeholder="Search your cars..."
        class="w-full bg-transparent text-white placeholder-white/80 input-bold outline-none">
    </div>

    <!-- Feed Button -->
    <a href=""
      class="flex glass px-4 py-2 rounded-2xl shadow-xl flex items-center space-x-3">
      Feed
    </a>
  </div>


</div>

<!-- Search Script -->
<script>
  document.getElementById("searchInput").addEventListener("input", function () {
    let query = this.value.toLowerCase();
    let cards = document.querySelectorAll(".car-card");

    cards.forEach(card => {
      let name = card.querySelector(".car-name").textContent.toLowerCase();
      let notes = card.querySelector(".car-notes")?.textContent.toLowerCase() || "";

      if (name.includes(query) || notes.includes(query)) {
        card.style.display = "flex";
      } else {
        card.style.display = "none";
      }
    });
  });
</script>
{% endblock %}